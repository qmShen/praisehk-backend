webpackJsonp([1],{0:function(t,e){},"67kR":function(t,e){},EYnv:function(t,e){},JkOZ:function(t,e){},"K8k/":function(t,e){},NHnr:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("7+uW"),n=i("q66U"),o=i.n(n),r=i("vwbq"),s=(i("EYnv"),[67,68,70,74,77,78,79,80,81,82,83,84,85,87,89,90]),l=function(t,e,i,a){var n=this;this.map=o.a.map(t,{zoomControl:!1}).setView(i.loc,9),this.featureType=a,o.a.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw",{maxZoom:24,id:"mapbox.light"}).addTo(this.map),o.a.circle(i.loc,100,{color:"steelblue",fillColor:"#f03",fillOpacity:.5}).addTo(this.map),this.svg=r.l("#"+e),this.signLoadData=!1,this.initializeVisualization(),this.HongKongSatationIdMap={},"AQ"==this.featureType&&s.forEach(function(t){n.HongKongSatationIdMap[t]=!0})};l.prototype.focus=function(t){this.map.setView(t,this.map.getZoom()),this.update_visualization()},l.prototype.mouseoverCircle=function(t){"AQ"==this.featureType?this.showAQCMAQ(t):"Mete"==this.featureType&&this.showMeteWRF(t)},l.prototype.setCurrentTimestamp=function(t){"AQ"==this.featureType?this.showAQCMAQ(t):"Mete"==this.featureType&&this.showMeteWRF(t)},l.prototype.mouseoutCircle=function(t){},l.prototype.initializeVisualization=function(){var t=r.i().domain([0,150]).range([0,400]);this.aqSizeScale=function(e){return Math.sqrt(t(e))};var e=r.i().domain([0,10]).range([0,70]);this.windScale=e},l.prototype.showAQCMAQ=function(t){var e=t.timestamp;if(void 0!=this.timeStationMapAQ&&void 0!=this.timeStationMapCMAQ){var i=this.timeStationMapAQ[e],a=this.timeStationMapCMAQ[e];if(void 0!=i&&void 0!=a)for(var n in this.idMap)this.visualizeCMAQAQunit(n,i[n],a[n])}};var u=function(t){return void 0!=t&&null!=t&&"null"!=t};l.prototype.on=function(t,e){"click"==t&&(this.clickOnStation=e)},l.prototype.loadStations=function(t){var e=this;this.stations=t,this.idMap={},this.stations.forEach(function(t){void 0==t.render&&(t.render={}),t.render.screen_loc=e.map.latLngToContainerPoint([t.latitude,t.longitude]),e.idMap[t.id]=t}),this.stationsContainers=this.svg.selectAll(".station_point").data(this.stations).enter().append("g").attr("class","station_point"),this.stationsContainers.each(function(t){t.render.svg_container=this});var i="AQ"==this.featureType?"#ff5b0d":"#2ca25f";if(this.color=i,this.stationsContainers.append("circle").attr("fill",i).attr("fill-opacity",.4).attr("stroke",i).attr("stroke-width",1).each(function(t){t.render.stationCircle=this}),"AQ"==this.featureType)this.stationsContainers.append("circle").attr("class","CMAQCircles").attr("r",0).attr("fill","#479886").attr("stroke","#479886").attr("stroke-width",1).attr("stroke","white").each(function(t){t.render.CMAQCircle=this}),this.stationsContainers.append("circle").attr("class","AQCircles").attr("r",0).attr("fill","#d77451").attr("stroke","#d77451").attr("stroke-width",1).attr("stroke","white").each(function(t){t.render.AQCircle=this});else if("Mete"==this.featureType){var a=this.stationsContainers.append("line").style("stroke","#d77451").attr("stroke-width",1.7).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",0),n=this.stationsContainers.append("line").style("stroke","#479886").attr("stroke-width",1.7).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",0),o=this.stationsContainers.append("path").attr("fill","none").attr("stroke","grey");a.each(function(t){t.render.WindLine=this}),n.each(function(t){t.render.WindWRFLine=this}),o.each(function(t){t.render.WindArc=this})}this.update_visualization(),this.map.on("move",function(t){e.update_visualization()})},l.prototype.update_visualization=function(t){var e=this;this.zoomLevel=this.map.getZoom();var i=0;i=this.zoomLevel>11?30:2.9*this.zoomLevel/6,this.stations.forEach(function(a){a.render.screen_loc=e.map.latLngToContainerPoint([a.latitude,a.longitude]),e.visualize_unit(a.render.svg_container,i,t)}),this.stationsContainers.attr("transform",function(t){return"translate("+[t.render.screen_loc.x,t.render.screen_loc.y]+")"})},l.prototype.visualize_unit=function(t,e,i){r.l(t).select("circle").attr("r",2).attr("class","station").attr("fill","none").attr("opacity",.4)},l.prototype.loadAQFeatureValue=function(t){var e=new Date,i={};t.forEach(function(t){var e=t.timestamp;for(var a in void 0!=i[e]&&null!=i[e]&&"null"!=i[e]||(i[e]={}),t){var n=t[a];i[e][a]=n}}),this.timeStationMapAQ=i,console.log("AQ Feature Value",new Date-e)},l.prototype.loadCMAQValue=function(t){var e=new Date,i={};t.forEach(function(t){var e=t.timestamp;for(var a in void 0!=i[e]&&null!=i[e]&&"null"!=i[e]||(i[e]={}),t){var n=t[a];i[e][a]=n}}),this.timeStationMapCMAQ=i,console.log("AQ CMAQ Value",new Date-e)},l.prototype.visualizeCMAQAQunit=function(t,e,i){r.l(this.idMap[t].render.svg_container);if(void 0!=e&&null!=e&&"null"!=e){r.l(this.idMap[t].render.AQCircle).transition().attr("r",this.aqSizeScale(e));var a=this.idMap[t].render.AQCircle;u(i)&&e<i&&a.parentNode.appendChild(a)}else r.l(this.idMap[t].render.AQCircle).attr("r",0).attr("stroke-width",1);if(void 0!=i&&null!=i&&"null"!=i){r.l(this.idMap[t].render.CMAQCircle).transition().attr("r",this.aqSizeScale(i));var n=this.idMap[t].render.CMAQCircle;u(i)&&e>i&&n.parentNode.appendChild(n)}else r.l(this.idMap[t].render.CMAQCircle).attr("r",0).attr("stroke-width",1)},l.prototype.loadWindValue=function(t){var e=new Date,i={};t.forEach(function(t){var e=t.timestamp;for(var a in u(i[e])||(i[e]={}),t){var n=t[a];i[e][a]=n}}),this.timeStationMapWind=i,console.log("Wind Feature Value",new Date-e)},l.prototype.loadWindDirValue=function(t){var e=new Date,i={};t.forEach(function(t){var e=t.timestamp;for(var a in u(i[e])||(i[e]={}),t){var n=t[a];i[e][a]=n}}),this.timeStationMapWindDir=i,console.log("WindDir Feature Value",new Date-e)},l.prototype.loadWindWRFValue=function(t){var e=new Date,i={};t.forEach(function(t){var e=t.timestamp;for(var a in u(i[e])||(i[e]={}),t){var n=t[a];i[e][a]=n}}),this.timeStationMapWindWRF=i,console.log("WindWRF Feature Value",new Date-e)},l.prototype.loadWindDirWRFValue=function(t){var e=new Date,i={};t.forEach(function(t){var e=t.timestamp;for(var a in u(i[e])||(i[e]={}),t){var n=t[a];i[e][a]=n}}),this.timeStationMapWindDirWRF=i,console.log("WindDirWRF Feature Value",new Date-e)},l.prototype.showMeteWRF=function(t){if(void 0!=this.timeStationMapWind&&void 0!=this.timeStationMapWindDir&&void 0!=this.timeStationMapWindWRF&&void 0!=this.timeStationMapWindDirWRF){var e=t.timestamp,i=this.timeStationMapWind[e],a=this.timeStationMapWindDir[e],n=this.timeStationMapWindWRF[e],o=this.timeStationMapWindDirWRF[e];if(void 0!=i&&void 0!=a&&void 0!=n&&void 0!=o)for(var r in this.idMap)this.visualizeWindDirUnit(r,i[r],a[r],n[r],o[r]);else for(var s in this.idMap)this.visualizeNothing(s)}},l.prototype.visualizeNothing=function(t){r.l(this.idMap[t].render.svg_container);var e=r.a().outerRadius(0).innerRadius(0).startAngle(0).endAngle(0);r.l(this.idMap[t].render.WindArc).attr("d",e).attr("fill-opacity",0).attr("stroke-opacity",0),r.l(this.idMap[t].render.WindArc).transition().attr("fill-opacity",.5).attr("stroke-opacity",.5),r.l(this.idMap[t].render.WindLine).transition().attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",0),r.l(this.idMap[t].render.WindWRFLine).transition().attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",0)},l.prototype.visualizeWindDirUnit=function(t,e,i,a,n){r.l(this.idMap[t].render.svg_container);if(u(e)&&u(i)&&u(a)&&u(n)){r.l(this.idMap[t].render.WindArc);var o=this.windScale(a),s=this.windScale(e),l=i%360,c=n%360,h=null,d=null,p=0,m=0,f=null;o>s?(p=o,m=s,f="#479886"):(p=s,m=o,f="#d77451"),l>c?(h=c,d=l):(h=l,d=c),d-h>180&&(d-=360);var v=h/180*Math.PI,g=d/180*Math.PI,M=r.a().outerRadius(p).innerRadius(m).startAngle(v).endAngle(g);r.l(this.idMap[t].render.WindArc).attr("d",M).attr("fill",f).attr("fill-opacity",0).attr("stroke",f).attr("stroke-opacity",0),r.l(this.idMap[t].render.WindArc).transition().attr("fill-opacity",.5).attr("stroke-opacity",.5);var y=this.windScale(e),A=y,S=(i-90)/180*Math.PI;r.l(this.idMap[t].render.WindLine).transition().attr("x1",0).attr("y1",0).attr("x2",function(t){return 0+A*Math.cos(S)}).attr("y2",0+A*Math.sin(S)),y=this.windScale(a),A=y,S=(n-90)/180*Math.PI,r.l(this.idMap[t].render.WindWRFLine).transition().attr("x1",0).attr("y1",0).attr("x2",0+A*Math.cos(S)).attr("y2",0+A*Math.sin(S))}};var c=l,h=i("8+8L");a.default.use(h.a);var d="http://127.0.0.1:9000",p=a.default.http;var m={loadRegions:function(t){var e=d+"/cmaq_region";p.get(e).then(function(e){t(e.data)},function(t){console.log(t)})},loadFeatureData:function(t,e){var i=d+"/feature_data";p.post(i,t).then(function(t){e(t.data)},function(t){console.log(t)})},loadCMAQOBSData:function(t,e){var i=d+"/load_cmaq_obs";p.post(i,{station_id:t}).then(function(t){e(t.data)},function(t){console.log(t)})},loadAQStations:function(t){var e=d+"/aq_stations";p.get(e).then(function(e){t(e.data)},function(t){console.log(t)})},loadMeteStations:function(t){var e=d+"/mete_stations";p.get(e).then(function(e){t(e.data)},function(t){console.log(t)})},loadFeatureValue:function(t,e){var i=d+"/load_observation";p.post(i,t).then(function(t){e(t.data)},function(t){console.log(t)})},loadModelValue:function(t,e){var i=d+"/load_model_value";p.post(i,t).then(function(t){e(t.data)},function(t){console.log(t)})}},f=new a.default({data:{SELECTEDSCATTER:"select_scatter_plot",SEQUENCESELECTED:"sequence_selected",SUBGROUPSELECTED:"subgroup_selected",SELECTEDINIDIVUDUAL:"selected_indiviual_selected",MOUSEOVERINDIVIDUAL:"mosueover_individual",CHECKINDIVIDUAL:"check_individual",MOUSEOVERFEATUREIMPORTANCE:"mouseover_featureimportance_boxplot",TIMERANGESELECTED:"time_range_selected"},methods:{emitSelectedScatterPlot:function(t){this.$emit(this.SELECTEDSCATTER,t)},onSelectedScatterPlot:function(t){this.$on(this.SELECTEDSCATTER,function(e){t(e)})},emitSequenceSelected:function(t){this.$emit(this.SEQUENCESELECTED,t)},onSequenceSelected:function(t){this.$on(this.SEQUENCESELECTED,function(e){t(e)})},emitSubgroupSelected:function(t){this.$emit(this.SUBGROUPSELECTED,t)},onSubgroupSelected:function(t){this.$on(this.SUBGROUPSELECTED,function(e){t(e)})},emitCheckIndividual:function(t){this.$emit(this.CHECKINDIVIDUAL,t)},onCheckIndividual:function(t){this.$on(this.CHECKINDIVIDUAL,function(e){t(e)})},emitMouseoverFeature:function(t){this.$emit(this.MOUSEOVERFEATUREIMPORTANCE,t)},onMouseoverFeature:function(t){this.$on(this.MOUSEOVERFEATUREIMPORTANCE,function(e){t(e)})},emitSelectedIndividuals:function(t){this.$emit(this.SELECTEDINIDIVUDUAL,t)},onSelectedIndividuals:function(t){this.$on(this.SELECTEDINIDIVUDUAL,function(e){t(e)})},emitMouseOverCell:function(t){this.$emit(this.MOUSEOVERINDIVIDUAL,t)},onMouseOverCell:function(t){this.$on(this.MOUSEOVERINDIVIDUAL,function(e){t(e)})},emitTimeRangeSelected:function(t){this.$emit(this.TIMERANGESELECTED,t)},onTimeRangeSelected:function(t){this.$on(this.TIMERANGESELECTED,function(e){t(e)})}}}),v={name:"Map",props:["stations","centerLoc","AQFeatureValue","CMAQFeatureValue","currentTime"],data:function(){return{featureType:"AQ",station:{station_id:"KC_A",station_name:"Kwai Chung Station",location:[22.3586,114.1271]},type:"AQ",loading:!1}},mounted:function(){var t=this;this.handler=new c("AQ_map_container","AQ_svg",this.centerLoc,this.type),f.onMouseOverCell(function(e){"click"==e.action?(t.handler.showAQCMAQ(e),console.log("click")):"over"==e.action||e.action})},watch:{stations:function(t){this.handler.loadStations(t)},centerLoc:function(t){this.handler.focus(t.loc)},AQFeatureValue:function(t){this.handler.loadAQFeatureValue(t)},CMAQFeatureValue:function(t){this.handler.loadCMAQValue(t)},currentTime:function(t){this.handler.setCurrentTimestamp({timestamp:t})}},methods:{clickOnStation:function(t){void 0!=t&&console.log("station click component",t)}}},g={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"boundary",staticStyle:{display:"block",position:"relative"}},[e("div",{staticClass:"mini_head"},[this._v("Map")]),this._v(" "),e("div",{staticStyle:{height:"calc(100%  - 20px)",width:"100%",position:"relative"}},[e("div",{staticStyle:{height:"100%",width:"100%"},attrs:{id:"AQ_map_container"}}),this._v(" "),e("svg",{staticStyle:{height:"100%",width:"100%",position:"absolute",left:"0",top:"0","pointer-events":"none","z-index":"1000"},attrs:{id:"AQ_svg"}})])])},staticRenderFns:[]};var M=i("VU/8")(v,g,!1,function(t){i("SNfJ")},null,null).exports,y={name:"Map",props:["stations","centerLoc","WindFeatureValue","WindWRFFeatureValue","WindDirFeatureValue","WindDirWRFFeatureValue","currentTime"],data:function(){return{featureType:"Mete",station:{station_id:"KC_A",station_name:"Kwai Chung Station",location:[22.3586,114.1271]},type:"Mete"}},mounted:function(){this.handler=new c("mete_map_container","mete_svg",this.centerLoc,this.type),f.onMouseOverCell(function(t){"click"==t.action||"over"==t.action||t.action})},watch:{stations:function(t){this.handler.loadStations(t)},centerLoc:function(t){this.handler.focus(t.loc)},WindFeatureValue:function(t){this.handler.loadWindValue(t)},WindWRFFeatureValue:function(t){this.handler.loadWindWRFValue(t)},WindDirFeatureValue:function(t){this.handler.loadWindDirValue(t)},WindDirWRFFeatureValue:function(t){this.handler.loadWindDirWRFValue(t)},currentTime:function(t){this.handler.setCurrentTimestamp({timestamp:t})}},methods:{clickOnStation:function(t){void 0!=t&&console.log("station click component",t)}}},A={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"boundary",staticStyle:{display:"block",position:"relative"}},[e("div",{staticClass:"mini_head"},[this._v("Mete Map")]),this._v(" "),e("div",{staticStyle:{height:"calc(100%  - 20px)",width:"100%",position:"relative"}},[e("div",{staticStyle:{height:"100%",width:"100%"},attrs:{id:"mete_map_container"}}),this._v(" "),e("svg",{staticStyle:{height:"100%",width:"100%",position:"absolute",left:"0",top:"0","pointer-events":"none","z-index":"1000"},attrs:{id:"mete_svg"}})])])},staticRenderFns:[]};var S=i("VU/8")(y,A,!1,function(t){i("jNCz")},null,null).exports,C=function(t){return parseInt(t.getTime()/1e3)},_=function(t){this.$el=t,this.svgWidth=this.$el.clientWidth,this.svgHeight=this.$el.clientHeight-20,this.margin={top:20,bottom:20,left:40,right:0},this.svg=r.l(t).append("svg").attr("width",this.svgWidth).attr("height",this.svgHeight),this.context=this.svg.append("g").attr("class","context")};_.prototype.on=function(t,e){"brushEnd"==t&&(this.brushEnd=e)},_.prototype.initTimeBrush=function(t,e){var i=this;t=void 0==t?1451739600:t,e=void 0==e?1546261200:e;var a=[new Date(1e3*t),new Date(1e3*e)];this.xScale=r.k().range([0,this.svgWidth-this.margin.left]).domain(a);var n=this.xScale,o=r.d().extent([[0,0],[this.svgWidth,this.svgHeight]]).on("end",function(){if(console.log("hereherehere"),r.e.sourceEvent&&"zoom"===r.e.sourceEvent.type)return;var t=(r.e.selection||i.xScale.range()).map(n.invert,n);i.brushEnd([C(t[0]),C(t[1])])});this.context.append("g").attr("transform","translate("+[this.margin.left,0]+")").attr("class","brush").call(o).call(o.move,[0,this.svgWidth/75]);var s=r.b().scale(this.xScale);this.context.append("g").attr("class","xAxis").call(s).attr("transform","translate("+[this.margin.left,this.svgHeight-this.margin.bottom]+")")};var E=_,W={name:"BrushPannel",props:["featureValues"],data:function(){return{}},watch:{featureValues:function(t){}},mounted:function(){this.handler=new E(this.$el),this.handler.on("brushEnd",this.handleBrushEnd),this.handler.initTimeBrush()},methods:{handleBrushEnd:function(t){f.emitTimeRangeSelected(t)}}},T={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{staticClass:"mini_head"},[this._v("brush")])])}]};var w=i("VU/8")(W,T,!1,function(t){i("JkOZ")},"data-v-74c955ad",null).exports,V={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"boundary",staticStyle:{display:"block",position:"relative"}},[e("div",{staticStyle:{height:"100%",width:"100%"}})])}]};var D=i("VU/8")({name:"Info",data:function(){return{}},watch:{}},V,!1,function(t){i("PGzC")},"data-v-faa6f49c",null).exports,F=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],R=[67,68,70,74,77,78,79,80,81,82,83,84,85,87,89,90],Q=function(t,e){this.$el=t,this.svgWidth=this.$el.clientWidth,this.svgHeight=this.$el.clientHeight,this.svg=r.l(t).append("svg").attr("width",this.svgWidth).attr("height",this.svgHeight),this.margin={top:20,bottom:20,left:40,right:0},this.update(e),this.HongKongSatationIdMap={}};Q.prototype.update=function(t){var e=this;if(0!=t.value.length){var i=t.value[0];for(var a in this.station_list=[],i)"timestamp"!=a&&this.station_list.push(a);this.feature=t.feature,this.valueArray=t.value,this.HongKongSatationIdMap={},"PM25"==this.feature&&R.forEach(function(t){e.HongKongSatationIdMap[t]=!0}),this.renderHeatmap()}else console.log("No data collected!")},Q.prototype.colors=["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Q.prototype.renderHeatmap=function(t){var e=this;this.stationTimeMap={},this.stationMap={};var i=(this.svgHeight-this.margin.top-this.margin.bottom)/this.station_list.length,a=i;this.svg.selectAll("g").remove(),this.container=this.svg.append("g").attr("transform","translate("+[this.margin.left,0]+")"),t=void 0==t?this.valueArray:t;var n=this.container.selectAll(".row").data(this.station_list).enter().append("g").attr("class","row").attr("transform",function(t,e){return"translate("+[0,i*e]+")"}),o=[];if(void 0!=t){t.forEach(function(t,e){o.push(t)});var s=[];this.station_list.forEach(function(e){s.push(r.h(t,function(t){return t[e]}))});r.h(s);var l=r.f(o,function(t){return t.timestamp}),u=r.i().domain(l).range([0,e.svgWidth-e.margin.right-e.margin.left]),c=(this.colors.length,[]);"PM25"==this.feature?(c=[0,10,20,30,40,50,60,70,80,90],100):"wind"==this.feature?(c=[0,2,4,6,8,10,12,14,16],10):"windDir"==this.feature&&(c=[18,36,54,72,90,108,126,144,162],180);var h=r.j().domain(c).range(this.colors);n.each(function(t,n){var s=r.l(this);1==e.HongKongSatationIdMap[t]&&s.append("circle").attr("cx",-1*a).attr("cy",a/2).attr("r",a/3).attr("fill","grey"),void 0==e.stationTimeMap[t]&&(e.stationTimeMap[t]={});r.f(o,function(e){return e[t]});var l=s.selectAll(".cell").data(o).enter().append("g").attr("class","cell").attr("transform",function(t){return"translate("+[u(t.timestamp),0]+")"});l.each(function(a,o){void 0==e.stationTimeMap[t][a.timestamp]&&(e.stationTimeMap[t][a.timestamp]={}),e.stationTimeMap[t][a.timestamp].e=this,e.stationTimeMap[t][a.timestamp].x=u(a.timestamp),e.stationTimeMap[t][a.timestamp].y=n*i});var c=l.append("rect").attr("width",a).attr("height",i).attr("fill",function(e){return"null"==e[t]||null==e[t]?"#d4d4d4":h(e[t])}).attr("rx",a/5).attr("stroke","white").attr("stroke-width",1);c.append("title").text(function(e){var i,a,n,o,r=e[t];return r=null==e[t]||"null"==e[t]?"Null":parseInt(100*r)/100,"Id: "+t+" error: "+r+"\n timestamp: "+(i=new Date(1e3*e.timestamp),a=i.getMonth()>=9?i.getMonth()+1:"0"+(i.getMonth()+1),n=i.getDate()>=10?i.getDate():"0"+i.getDate(),o=i.getHours()>=10?i.getHours():"0"+i.getHours(),i.getFullYear()+"-"+a+"-"+n+" "+o+":00:00  "+F[i.getDay()])}),c.on("mouseover",function(i){e.mouseover({timestamp:i.timestamp,stationId:t})}),c.on("mouseout",function(i){e.mouseout({timestamp:i.timestamp,stationId:t})}),c.on("click",function(i){e.click({timestamp:i.timestamp,stationId:t})})}),this.HightLightRowRect=this.container.append("rect").attr("fill","none").attr("stroke","#fd8d3c").attr("width",this.svgWidth-this.margin.left-this.margin.right).attr("height",a).attr("stroke-width",0),this.HightLightColumnRect=this.container.append("rect").attr("fill","none").attr("stroke","#fd8d3c").attr("width",a).attr("height",this.svgHeight-this.margin.top-this.margin.bottom).attr("stroke-width",0),n.append("rect").attr("fill","none").attr("stroke","red").attr("width",e.svgWidth-e.margin.left-e.margin.right).attr("height",a).attr("stroke-width",0).each(function(t){e.stationMap[t]=this})}},Q.prototype.on=function(t,e){"mouseover"==t?this.mouseover=e:"mouseout"==t?this.mouseout=e:"click"==t&&(this.click=e)},Q.prototype.onMouseInter=function(t){var e=t.timestamp,i=t.stationId,a=this.stationTimeMap[i][e];void 0!=a&&(this.HightLightRowRect.attr("y",a.y).attr("stroke-width",.5),this.HightLightColumnRect.attr("x",a.x).attr("stroke-width",.5))},Q.prototype.updateByTimeRange=function(t){this.renderHeatmap(t[0],t[1])};var L=Q,k={name:"FeatureValue",props:["item"],data:function(){return{type:null}},watch:{item:function(){console.log("item changed",this.item),this.handler.update(this.item)}},mounted:function(){var t=this;console.log("item",this.item),"PM25"==this.item.feature?this.type="AQ":"Wind"!=this.item.feature&&"WindDir"!=this.item.feature||(this.type="Mete"),this.handler=new L(this.$el,this.item),this.handler.on("mouseover",this.handleMouseover),this.handler.on("mouseout",this.handleMouseout),this.handler.on("click",this.handleMouseClick),f.onMouseOverCell(function(e){t.handler.onMouseInter(e)}),f.onTimeRangeSelected(function(e){t.handler.updateByTimeRange(e)})},methods:{handleMouseover:function(t){t.action="over",t.type=this.type,f.emitMouseOverCell(t)},handleMouseout:function(t){t.action="out",t.type=this.type,f.emitMouseOverCell(t)},handleMouseClick:function(t){t.action="click",t.type=this.type,f.emitMouseOverCell(t)}}},b={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"boundary",staticStyle:{display:"block",position:"relative"}},[e("div",{staticClass:"mini_head"},[this._v(this._s(this.item.feature))])])},staticRenderFns:[]};var x=i("VU/8")(k,b,!1,function(t){i("NRvW")},"data-v-a7878a48",null).exports,I=(i("BD/k"),function(t){this.$el=t,this.svgWidth=this.$el.clientWidth,this.svgHeight=this.$el.clientHeight-20,this.svg=r.l(t).append("svg").attr("width",this.svgWidth).attr("height",this.svgHeight),this.margin={top:20,bottom:20,left:40,right:0}});I.prototype.set_currentTIme=function(t){},I.prototype.setTimeRange=function(t){this.timerange=t,this.data&&this.render()},I.prototype.render=function(){var t=this,e=[];this.data.forEach(function(i){i.timestamp>t.timerange[0]&&i.timestamp<t.timerange[1]&&(i.time=new Date(1e3*i.timestamp),e.push(i))}),this.svg.selectAll("g").remove(),this.container=this.svg.append("g");var i=r.f(e,function(t){return t.time}),a=r.k().domain(i).range([0,this.svgWidth-this.margin.right-this.margin.left]);this.xScale=a;var n=r.b().scale(a).tickFormat(function(t){return t.getFullYear()+"/"+t.getMonth()+"/"+t.getDate()+" "+t.getHours()+":00"}),o=r.h([r.h(e,function(t){return t.val_aq}),r.h(e,function(t){return t.val_cmaq})]);this.yMax=o,this.yMax=100;var s=r.i().domain([0,this.yMax]).range([this.svgHeight-this.margin.bottom,this.margin.top]),l=r.c().scale(s),u=r.g().x(function(t){return a(t.time)}).y(function(t){return null==t.val_cmaq||"null"==t.val_cmaq?s(0):s(t.val_cmaq)}),c=this.container.append("g").attr("transform","translate("+[this.margin.left,0]+")");c.selectAll("path").data([e]).enter().append("path").attr("d",u).attr("fill","none").attr("stroke","blue"),c.append("g").attr("class","xAxis").call(n).attr("transform","translate("+[0,this.svgHeight-this.margin.bottom]+")"),c.append("g").attr("class","yAxis").call(l);var h=this.container.append("g").attr("transform","translate(40,0)");h.selectAll("circle").data(e).enter().append("circle").attr("cx",function(t){return a(t.time)}).attr("cy",function(e){return"null"==e.val_aq||void 0==e.val_aq?s(t.yMax):s(e.val_aq)}).attr("r",1.5).attr("fill",function(t){return"null"==t.val_aq||void 0==t.val_aq?"grey":"red"}),this.currentTimeLine=h.append("line").attr("stroke-width",0).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",0)},I.prototype.setData=function(t){this.data=t,this.render()},I.prototype.setCurrentTimestamp=function(t){if(void 0!=this.data&&null!=this.data&&void 0!=this.currentTimeLine){var e=this.xScale(new Date(1e3*t));this.currentTimeLine.style("stroke","#984a23").attr("stroke-width",1).attr("x1",e).attr("y1",this.margin.top).attr("x2",e).attr("y2",this.svgHeight-this.margin.bottom)}};var N=I,H={name:"LineChart",props:["currentTime"],mounted:function(){var t=this;this.LineChart=new N(this.$el),f.onMouseOverCell(function(e){"click"==e.action&&t.queryModelObs(e.stationId)}),f.onTimeRangeSelected(function(e){t.LineChart.setTimeRange(e)})},watch:{currentTime:function(t){this.LineChart.setCurrentTimestamp(t)}},methods:{queryModelObs:function(t){var e=this;m.loadCMAQOBSData(t,function(t){e.LineChart.setData(t)})}}},O={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"boundary"},[e("div",{staticClass:"mini_head"},[this._v("Obs VS CMAQ")]),this._v(" "),this._t("default")],2)},staticRenderFns:[]};var U={name:"MainView",data:function(){return{station:{station_id:"KC_A",station_name:"Kwai Chung Station",location:[22.3586,114.1271]},msg:"Welcome to Your Vue.js App",featureValues:[],AQStations:[],meteStations:[],centerLoc:{loc:[22.3586,114.1271]},AQFeatureValue:null,CMAQFeatureValue:null,WindFeatureValue:null,WindWRFFeatureValue:null,WindDirFeatureValue:null,WindDirWRFFeatureValue:null,currentTime:null,timeRange:[],AQMapLoading:!0,MeteMapLoading:!0,FeatureValueLoading:!0,AQDataN:0,MeteDataN:0,timeHandler:null,buttonDisable:!1,mapReadyN:0}},mounted:function(){var t=this,e=null;e={startTime:null,endTime:null},f.onTimeRangeSelected(function(i){t.AQMapLoading=!0,t.MeteMapLoading=!0,t.FeatureValueLoading=!0,e={startTime:i[0],endTime:i[1]},m.loadFeatureData(e,function(e){t.featureValues=e,t.FeatureValueLoading=!1}),t.timeRange=i,t.AQDataN=0,t.MeteDataN=0,t.mapReadyN=0,e={ids:"all",feature:"PM25",timeRange:1,startTime:i[0],endTime:i[1]},m.loadFeatureValue(e,function(e){t.AQFeatureValue=e,t.AQDataN+=1}),m.loadModelValue(e,function(e){t.CMAQFeatureValue=e,t.AQDataN+=1}),e={ids:"all",feature:"wind",timeRange:1,startTime:i[0],endTime:i[1]},m.loadFeatureValue(e,function(e){t.WindFeatureValue=e,t.MeteDataN+=1}),m.loadModelValue(e,function(e){t.WindWRFFeatureValue=e,t.MeteDataN+=1}),e={ids:"all",feature:"winddir",timeRange:1,startTime:i[0],endTime:i[1]},m.loadFeatureValue(e,function(e){t.WindDirFeatureValue=e,t.MeteDataN+=1}),m.loadModelValue(e,function(e){t.WindDirWRFFeatureValue=e,t.MeteDataN+=1})}),m.loadAQStations(function(e){t.AQStations=e}),m.loadMeteStations(function(e){t.meteStations=e}),f.onMouseOverCell(function(e){if("click"==e.action)t.AQStations.forEach(function(i){i.id==e.stationId&&(t.centerLoc={loc:[i.latitude,i.longitude]})});else if("over"==e.action){t.currentTime=e.timestamp}})},watch:{AQDataN:function(t){2==t&&(this.AQMapLoading=!1,this.mapReadyN+=1)},MeteDataN:function(t){4==t&&(this.MeteMapLoading=!1,this.FeatureValueLoading=!1,this.mapReadyN+=1)},mapReadyN:function(t){this.buttonDisable=2!=t}},methods:{playAnimation:function(){var t=this,e=this;this.timeHandler=setInterval(function(){void 0==e.currentTime&&(e.currentTime=e.timeRange[0]),t.currentTime=t.currentTime+3600,t.currentTime>=t.timeRange[1]&&clearInterval(t.timeHandler)},1e3)},stopAnimation:function(){this.timeHandler&&clearInterval(this.timeHandler)}},components:{AQMap:M,MeteMap:S,Statistics:D,FeatureHeatmap:x,BrushPannel:w,TargetFeatureValue:i("VU/8")(H,O,!1,function(t){i("K8k/")},"data-v-2cdcb75f",null).exports}},$={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"main"},[i("el-row",{staticClass:"horizontal_stripe",attrs:{gutter:10}},[i("el-col",{staticClass:"left",attrs:{span:8}},[i("AQMap",{directives:[{name:"loading",rawName:"v-loading",value:t.AQMapLoading,expression:"AQMapLoading"}],staticStyle:{height:"50%",width:"100%"},attrs:{stations:t.AQStations,centerLoc:t.centerLoc,AQFeatureValue:t.AQFeatureValue,CMAQFeatureValue:t.CMAQFeatureValue,currentTime:t.currentTime,"element-loading-text":"Loading","element-loading-background":"rgba(0, 0, 0, 0.7)"}}),t._v(" "),i("MeteMap",{directives:[{name:"loading",rawName:"v-loading",value:t.MeteMapLoading,expression:"MeteMapLoading"}],staticStyle:{height:"50%",width:"100%"},attrs:{stations:t.meteStations,centerLoc:t.centerLoc,WindFeatureValue:t.WindFeatureValue,WindWRFFeatureValue:t.WindWRFFeatureValue,WindDirFeatureValue:t.WindDirFeatureValue,WindDirWRFFeatureValue:t.WindDirWRFFeatureValue,currentTime:t.currentTime,"element-loading-text":"Loading","element-loading-background":"rgba(0, 0, 0, 0.7)"}})],1),t._v(" "),i("el-col",{staticClass:"right",attrs:{span:16}},[i("BrushPannel",{staticClass:"boundary",staticStyle:{width:"100%",height:"8%"},attrs:{featureValues:t.featureValues}}),t._v(" "),i("TargetFeatureValue",{directives:[{name:"loading",rawName:"v-loading",value:t.AQMapLoading,expression:"AQMapLoading"}],staticClass:"boundary",staticStyle:{width:"100%",height:"17%",position:"relative"},attrs:{currentTime:t.currentTime,"element-loading-text":"Loading","element-loading-background":"rgba(0, 0, 0, 0.4)"}},[i("div",{staticStyle:{position:"absolute",right:"10px",top:"25px"}},[i("el-button",{attrs:{type:"success",icon:"el-icon-video-play",size:"mini",disabled:t.buttonDisable,plain:""},on:{click:t.playAnimation}}),t._v(" "),i("el-button",{attrs:{type:"success",icon:"el-icon-video-pause",size:"mini",disabled:t.buttonDisable,plain:""},on:{click:t.stopAnimation}})],1)]),t._v(" "),i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.AQMapLoading,expression:"AQMapLoading"}],staticClass:"boundary",staticStyle:{width:"100%",height:"calc(75%)"},attrs:{currentTime:t.currentTime,"element-loading-text":"Loading","element-loading-background":"rgba(0, 0, 0, 0.4)"}},t._l(t.featureValues,function(e){return i("FeatureHeatmap",{key:e.feature,staticStyle:{width:"100%",height:"calc(100% )"},attrs:{item:e}},[t._v("\n          "+t._s(e.feature)+"\n        ")])}),1)],1)],1)],1)},staticRenderFns:[]};var z={name:"App",components:{MainView:i("VU/8")(U,$,!1,function(t){i("67kR")},"data-v-0dbd0274",null).exports}},q={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("MainView")],1)},staticRenderFns:[]};var P=i("VU/8")(z,q,!1,function(t){i("qdmO")},null,null).exports,B=i("/ocq");a.default.use(B.a);var K=new B.a({routes:[{path:"/",name:"HelloWorld"}]}),G=i("zL8q"),Y=i.n(G),j=(i("tvR6"),i("wUZ8")),J=i.n(j);a.default.config.productionTip=!1,a.default.use(Y.a,{locale:J.a}),new a.default({el:"#app",router:K,components:{App:P},template:"<App/>"})},NRvW:function(t,e){},PGzC:function(t,e){},SNfJ:function(t,e){},jNCz:function(t,e){},qdmO:function(t,e){},tvR6:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.f85e18437f16f23d9c9a.js.map